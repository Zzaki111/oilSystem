# 石油生产数据预处理系统架构图

## 整体架构
```
                    +------------------+
                    |   前端界面       |
                    |  (HTML/CSS/JS)   |
                    +--------+---------+
                             |
                    +--------v---------+
                    |   API网关        |
                    |   (Flask)        |
                    +--------+---------+
                             |
        +--------------------+--------------------+
        |                    |                    |
+-------v-------+    +-------v-------+    +-------v-------+
|  业务服务层   |    |  数据导入导出  |    |  缓存管理    |
|  (Services)   |    |   (Utils)     |    |  (In-Memory) |
+-------+-------+    +-------+-------+    +-------+-------+
        |                    |                    |
        +--------------------+--------------------+
                             |
                    +--------v---------+
                    |   数据模型层     |
                    |  (Data Models)   |
                    +--------+---------+
                             |
                    +--------v---------+
                    |   数据存储       |
                    |  (Excel Files)   |
                    +------------------+
```

## 业务服务层 (Services)
```
+--------------------------------------------+
|               业务服务层                   |
+--------------------------------------------+
| business_service_1.py | A2与SEC对比        |
|                       | 生成油井单元属性表  |
+--------------------------------------------+
| business_service_2.py | 年度A2对比         |
|                       | 识别井号变化       |
+--------------------------------------------+
| business_service_3.py | 生成本年度SEC表    |
|                       | 单元调整、新井添加 |
+--------------------------------------------+
| business_service_4.py | 生成评估数据表     |
|                       | 常规油/页岩油处理  |
+--------------------------------------------+
```

## 前端界面结构
```
+--------------------------------------------------+
|              主界面                              |
+--------------------------------------------------+
| [业务1] [业务2] [业务3] [业务4] [帮助]          |
+--------------------------------------------------+
|                                                  |
|  业务1界面: A2与SEC对比                          |
|  ┌─────────────────────────────────────────────┐ |
|  │ • 上传上年度A2表                            │ |
|  │ • 上传上年度SEC表                           │ |
|  │ • 生成油井单元属性表                        │ |
|  │ • 查看差异统计                              │ |
|  └─────────────────────────────────────────────┘ |
|                                                  |
|  业务2界面: 年度A2对比                           |
|  ┌─────────────────────────────────────────────┐ |
|  │ • 上传上年度A2表                            │ |
|  │ • 上传本年度A2表                            │ |
|  │ • 识别注销井/新投井/变化井                  │ |
|  │ • 查看变化统计                              │ |
|  └─────────────────────────────────────────────┘ |
|                                                  |
|  业务3界面: 生成本年度SEC表                      |
|  ┌─────────────────────────────────────────────┐ |
|  │ • 上传上年度SEC表                           │ |
|  │ • 上传单元变化表(可选)                      │ |
|  │ • 上传老区新井表(可选)                      │ |
|  │ • 上传PUD转PDP表(可选)                      │ |
|  │ • 生成本年度SEC表                           │ |
|  └─────────────────────────────────────────────┘ |
|                                                  |
|  业务4界面: 生成评估数据表                       |
|  ┌─────────────────────────────────────────────┐ |
|  │ 选择类型: [常规油 ▼] [页岩油 ▼]             │ |
|  │                                             │ |
|  │ 常规油子页面:                               │ |
|  │ • 上传多项数据表                            │ |
|  │ • 三步处理流程                              │ |
|  │ • 生成常规油评估数据表                      │ |
|  │                                             │ |
|  │ 页岩油子页面:                               │ |
|  │ • 上传相关数据表                            │ |
|  │ • 更新页岩油评估数据表                      │ |
|  └─────────────────────────────────────────────┘ |
+--------------------------------------------------+
```

## 数据流向
```
用户上传Excel文件
       ↓
   数据导入导出层
       ↓
   数据验证与预处理
       ↓
   业务服务处理
       ↓
   结果数据生成
       ↓
   Excel文件输出
       ↓
   用户下载结果
```

## 关键特性
- **模块化设计**：四个业务界面独立实现，便于维护扩展
- **缓存机制**：临时数据缓存，提高处理效率
- **数据验证**：多层数据验证，确保数据质量
- **错误处理**：完善的异常处理机制
- **性能优化**：针对大规模数据处理优化
- **国企风格**：专业稳重的界面设计