# 第三业务界面使用说明

## 功能概述

根据单元变化、老区新井、扩边/PUD转PDP/PDNP井等信息，生成本年度SEC数据表。

## 输入数据要求

### 1. 上年度SEC数据表（必需）
- **文件格式**：Excel文件（.xlsx 或 .xls）
- **必需字段**：
  - 井号
  - SEC油田
  - SEC单元
  - 年月
- **示例文件**：`SEC数据表-202409_sample.xlsx`

### 2. 单元变化表（可选）
- **文件格式**：Excel文件（.xlsx 或 .xls）
- **必需字段**：
  - 井号
  - 上年度大油田
  - 本年度大油田
  - 上年度单元
  - 本年度单元
- **示例文件**：`SEC单元变化表-202509_sample.xlsx`

### 3. 老区新井表（可选）
- **文件格式**：Excel文件（.xlsx 或 .xls）
- **必需字段**：
  - 井号
  - 大油田
  - 单元
  - 新井类型（需包含"老区新井"）
- **示例文件**：`老区新井表-202509_sample.xlsx`

### 4. 扩边/PUD转PDP/PDNP表（可选）
- **文件格式**：Excel文件（.xlsx 或 .xls）
- **必需字段**：
  - 井号
  - SEC油田
  - SEC单元
- **示例文件**：`扩边PUD转PDP表-202509_sample.xlsx`

## 处理流程

### 步骤1：调整SEC单元归属
- 根据单元变化表更新井的SEC油田和SEC单元归属
- 生成年份对应的SEC归属字段（如2025SEC油田、2025SEC单元）

### 步骤2：导入老区新井
- 将老区新井添加到SEC数据表中
- 确保新井具有完整的SEC归属信息
- 设置参评标志为"是"

### 步骤3：导入扩边/PUD转PDP/PDNP井
- 将扩边井、PUD转PDP井、PUD转PDNP井添加到SEC数据表中
- 验证SEC油田和SEC单元字段不为空
- 设置参评标志为"是"

## 输出结果

- **输出文件**：本年度SEC数据表（Excel格式）
- **包含字段**：
  - 基础字段：井号、大油田、单元、SEC油田、SEC单元、是否参评、页岩油/常规、年月
  - 年度字段：[年份]SEC油田、[年份]SEC单元
  - 其他字段：井别、井型、油藏类型等

## 使用步骤

### Web界面操作
1. 访问系统Web界面（http://localhost:5001）
2. 点击"第三业务界面"标签
3. 上传必需的上年度SEC数据表
4. 上传可选的单元变化表、老区新井表、扩边/PUD转PDP/PDNP表
5. 输入本年度年份（4位数字，如2025）
6. 输入本年度年月（6位数字，如202509）
7. 点击"生成SEC数据表"按钮
8. 等待处理完成，下载生成的SEC数据表

### 示例数据
系统已生成示例数据文件：
- `data/input/SEC数据表-202409_sample.xlsx` - 上年度SEC数据表
- `data/input/SEC单元变化表-202509_sample.xlsx` - 单元变化表
- `data/input/老区新井表-202509_sample.xlsx` - 老区新井表
- `data/input/扩边PUD转PDP表-202509_sample.xlsx` - 扩边/PUD转PDP/PDNP表

## API接口

### 上传文件
- **接口**：`POST /api/upload`
- **参数**：file, type
- **类型**：sec, unit_change, new_wells, pud_pdp_pdnp

### 生成SEC表
- **接口**：`POST /api/business3/generate`
- **参数**：
  - `last_year_sec_key`：上年度SEC数据缓存键（必需）
  - `unit_change_key`：单元变化表缓存键（可选）
  - `old_area_wells_key`：老区新井表缓存键（可选）
  - `pud_pdp_pdnp_key`：扩边/PUD表缓存键（可选）
  - `this_year`：本年度年份（必需）
  - `this_year_month`：本年度年月（必需）

## 错误处理

- **文件格式错误**：检查Excel文件格式是否正确
- **字段缺失**：确认必需字段是否存在
- **数据验证失败**：检查数据格式和内容是否符合要求
- **SEC归属为空**：确保扩边/PUD转PDP/PDNP表中的SEC油田和SEC单元不为空

## 注意事项

1. **年份格式**：年份必须为4位数字（如2025）
2. **年月格式**：年月必须为6位数字（如202509）
3. **字段映射**：确保输入文件字段名称与系统要求一致
4. **数据完整性**：上传的文件应包含完整且准确的数据
5. **文件大小**：建议单个文件不超过50MB

## 测试验证

系统包含测试脚本 `test_business3.py`，可验证第三业务界面功能的正确性。

---

**版本**：v1.0  
**更新日期**：2026-01-10